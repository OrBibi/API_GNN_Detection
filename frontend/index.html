<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GNN API Guard</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background: #f4f4f9; }
        textarea { width: 100%; height: 200px; font-family: monospace; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        #result { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .Attack { background: #ffdada; color: #a94442; border: 1px solid #ebccd1; }
        .Benign { background: #dff0d8; color: #3c763d; border: 1px solid #d6e9c6; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è API Log Classifier</h1>
    <p>Paste a full JSON log (request/response) to analyze:</p>
    <textarea id="logInput" placeholder='{"request": {...}, "response": {...}}'></textarea>
    <button onclick="sendAnalysis()">Analyze Log</button>

    <div id="result"></div>

    <script>
        async function sendAnalysis() {
            const resultDiv = document.getElementById('result');
            try {
                const logData = JSON.parse(document.getElementById('logInput').value);
                resultDiv.style.display = 'block';
                resultDiv.className = '';
                resultDiv.innerText = "Analyzing...";

                const resp = await fetch('http://localhost:8000/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(logData)
                });
                const { job_id } = await resp.json();
                pollStatus(job_id);
            } catch (e) { alert("Invalid JSON format!"); }
        }

        async function pollStatus(jobId) {
            const interval = setInterval(async () => {
                const resp = await fetch(`http://localhost:8000/status/${jobId}`);
                const data = await resp.json();
                if (data.status === 'Completed') {
                    clearInterval(interval);
                    const div = document.getElementById('result');
                    div.innerText = `Prediction: ${data.result}`;
                    div.className = data.result;
                }
            }, 1000);
        }
    </script>
</body>
</html>